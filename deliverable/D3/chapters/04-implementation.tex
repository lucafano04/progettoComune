\chapter{Implementazione}
L'applicazione è stata sviluppata usando il linguaggio di programmazione ``\texttt{TypeScript}'' sia per la parte di \textit{frontend} che per quella di \textit{backend}. Per la parte di \textit{backend} è stato sfruttato il \textit{runtime system} ``\texttt{Node.js}'' e il \textit{framework} ``\texttt{Express.js}'' per la creazione e gestione del \textit{server}. Per la parte di \textit{frontend} è stato utilizzato il \textit{framework} ``\texttt{Vue.js}'' con la libreria ``\texttt{PrimeVue}'' per alcune componenti grafiche. Il \textit{database} utilizzato è ``\texttt{MongoDB}'' e per la gestione delle dipendenze è stato utilizzato ``\texttt{npm}''.\newline
Si è inoltre scelto di usare \texttt{Vite} come \textit{bundler} per la parte di \textit{frontend} e \texttt{Webpack} per la parte di \textit{backend}. Oltre a questo per alcuni stili della libreria \texttt{PrimeVue} è stato usato \texttt{Tailwind CSS} e come conseguenza è stato usato \texttt{PostCSS} per la gestione dei fogli di stile. \newline
La scelta di usare \texttt{TypeScript} è scaturita dalla necessità di avere un controllo maggiore sul \textit{type-checking} e per avere una maggiore manutenibilità del codice, è sata creata infatti una vera e propria gerarchia di tipi per la gestione dei dati sia lato \textit{frontend} che lato \textit{backend}. \newline
La scelta del presente \textit{stack} tecnologico è stata fatta in base al materiale fornito dal corso ed conoscenze pregresse di alcuni membri del gruppo.

\section{Repository Organization}
    Il codice del progetto, disponibile presso la seguente repository \url{https://github.com/lucafano04/progettoComune}, è stato organizzato seguendo la seguente struttura:
    \dirtree{%
        .1 /.
        .2 /.github.
        .3 /workflows\DTcomment{Directory per le action di GitHub (Compilazione \LaTeX{} e test)}.
        .2 /.vscode\DTcomment{Directory per le impostazioni di Visual Studio Code}.
        .2 /APIdoc.
        .3 api.yaml\DTcomment{Documentazione \texttt{API}}.
        .2 /app\DTcomment{Directory per il codice di \textit{backend}}.
        .3 /db.
        .4 /models\DTcomment{Directory per i modelli del \textit{database}}.
        .4 index.ts\DTcomment{File di inizializzazione del \textit{database}}.
        .4 schemas.ts\DTcomment{File per la definizione degli schemi del \textit{database}}.
        .3 /routes\DTcomment{Directory per le rotte e gli \textit{endpoints} delle \texttt{API}}.
        .3 /tests\DTcomment{Directory per i test \texttt{Jest} per il \textit{backend}}.
        .3 /utils\DTcomment{Directory per le \textit{utility} di \textit{backend}}.
        .3 app.ts\DTcomment{File di inizializzazione dell'applicazione \texttt{Express.js}}.
        .3 variables.ts\DTcomment{File per la definizione delle variabili globali e ambientali}.
        .2 /deliverable\DTcomment{Directory per i \textit{deliverable} \LaTeX{}}.
        .3 /D*\DTcomment{Directory per il \textit{deliverable} D*, con * numero del \textit{deliverable}}.
        .3 /images\DTcomment{Directory comune per le immagini di tutti i \textit{deliverable}}.
        .2 /src\DTcomment{Directory per il codice di \textit{frontend}}.
        .3 /assets\DTcomment{Directory per gli \textit{asset} dell'applicazione}.
        .3 /components\DTcomment{Directory per le componenti dell'applicazione}.
        .3 /utils\DTcomment{Directory per le \textit{utility} di \textit{frontend}}.
        .3 App.vue\DTcomment{Componente radice dell'applicazione}.
        .3 index.css\DTcomment{File per il foglio di stile globale}.
        .3 main.ts\DTcomment{File di inizializzazione dell'applicazione \texttt{Vue.js}}.
        .2 /types.
        .3 /Circoscrizioni\DTcomment{Tipi per le circoscrizioni}.
        .3 /Dati\DTcomment{Tipi per i dati comuni a circoscrizioni e quartieri}.
        .3 /Quartieri\DTcomment{Tipi per i quartieri}.
        .3 /Sondaggi\DTcomment{Tipi per i sondaggi}.
        .3 /Utenti\DTcomment{Tipi per gli utenti}.
        .3 /Voti\DTcomment{Tipi per i voti}.
        .3 index.d.ts\DTcomment{File per il raggruppamento dei tipi}.
        .2 .env.example\DTcomment{File di esempio per le variabili ambientali}.
        .2 .gitignore\DTcomment{File per la definizione dei file da ignorare}.
        .2 index.html\DTcomment{Pagina HTML di base dell'applicazione}.
        .2 index.ts\DTcomment{File di inizializzazione dell'applicazione}.
        .2 package.json\DTcomment{File per la definizione delle dipendenze}.
        .2 pitch.pptx\DTcomment{Presentazione del progetto}.
        .2 *.config.js\DTcomment{File per la configurazione di \texttt{Webpack}, \texttt{TailWind} e \texttt{PostCSS}. Sostituendo * con la configurazione desiderata}.
        .2 tsconfig.*.json\DTcomment{File vari per la configurazione di \texttt{TypeScript}. Sostituendo * con la configurazione desiderata}.
        .2 vite.config.ts\DTcomment{File per la configurazione di \texttt{Vite} per la parte di \textit{frontend}}.
    }
\section{\textit{Branching Strategy} e organizzazione del lavoro}
    Per la gestione del lavoro si è scelto di utilizzare la piattaforma \texttt{GitHub} e di adottare una strategia di \textit{branching} basata su \textit{GitFlow}. In particolare si è deciso di utilizzare i seguenti \textit{branch}:
    \begin{description}
        \item[\texttt{main}] \textit{Branch} principale, contiene il codice stabile e funzionante;
        \item[\texttt{frontend}] \textit{Branch} per lo sviluppo della parte di \textit{frontend};
        \item[\texttt{MongoDB-Backend}] \textit{Branch} per lo sviluppo della parte di \textit{backend} e del \textit{database};
        \item[\texttt{D*} e \texttt{modificheD*}] \textit{Branch} per lo sviluppo dei \textit{deliverable} D* e per le modifiche successive;
        \item[\texttt{UserStory} - \texttt{UserWorkFlow}] \textit{Branch} per la scrittura delle \textit{User Story} il disegno dei \textit{User WorkFlow}. Questi erano \textit{branch} temporanei figli del \textit{branch} \texttt{D2};
        \item[\textit{altri}] Altri \textit{branch} che sono stati creati per lo sviluppo di \textit{pitch} o prime parti iniziali per il \textit{deliverable} \texttt{D1};
    \end{description}
    Come suddivisione dello sviluppo e della scrittura dei \textit{deliverable} si è scelto di assegnare ad ogni membro del gruppo una particolare area di lavoro individuando un responsabile principale per le varie aree di sviluppo e stesura dei documenti, per le slides di \textit{pitch} ognuno ha contribuito in modo equo. Distinguiamo quindi i seguenti ruoli:
    \begin{description}
        \item[Luca Facchini] Responsabile della parte pratica di \textit{backend}, \textit{frontend}. Responsabile principale per la scrittura del documento \texttt{D3}. Addetto alla prima scrittura di requisiti funzionali e non funzionali per il \textit{deliverable} D1; 
        \item[Luca Prigione] Responsabile principale per il documento \texttt{D1} e co-responsabile per il documento \texttt{D2}. Responsabile inoltre per la parte pratica riguardante la struttura del \textit{database}. Addetto alla stesura delle \textit{UserStories} per il \texttt{D3};
        \item[Enrico Faa] Co-responsabile per il documento \texttt{D2} e responsabile di tutti i grafici presenti su tutti i documenti (\texttt{UserWorkFlow}, \texttt{UseCaseDiagram}, \texttt{ClassDiagram}, \dots). Addetto alla stesura delle \textit{UserStories} per il \texttt{D3} ed addetto alla parte di \textit{Testing} per il \texttt{D3}; Addetto inoltre alla prima stesura della descrizione del progetto
    \end{description}
\section{\textit{Dependency}}
    \paragraph{Dipendenze principali} Sono state utilizzate le seguenti dipendenze principali:
    \begin{description}
        \item[\texttt{express}] per la creazione e gestione del \textit{server} e delle rotte;
        \item[\texttt{mongoose}] per la gestione del \textit{database};
        \item[\texttt{mongodb}] per la connessione al \textit{database};
        \item[\texttt{jsonwebtoken}] per la gestione dei \textit{token} di autenticazione;
    \end{description}
    \paragraph{Dipendenze di sviluppo}
    \begin{description}
        \item[\texttt{concurrenly}] per l'esecuzione di più comandi in parallelo durante le fasi di sviluppo e \textit{build} del progetto;
        \item[\texttt{dotenv}] per la gestione delle variabili ambientali;
        \item[\texttt{jest}] per la gestione dei test;
        \item[\texttt{supertest} e \texttt{ts-jest}] per la gestione dei test \textit{end-to-end};
        \item[\texttt{nodemon}] per il \textit{hot-reloading} del \textit{server} in fase di sviluppo;
        \item[\texttt{postcss}] per la gestione dei fogli di stile;
        \item[\texttt{primevue}] per la creazione di alcune componenti grafiche;
        \item[\texttt{tailwindcss}] per la disposizione della \textit{responsiveness} delle componenti;
        \item[\texttt{TypeScript}] per il \textit{type-checking} e la gestione dei tipi;
        \item[\texttt{ts-node}] per l'esecuzione di codice \texttt{TypeScript} direttamente da \texttt{Node.js};
        \item[\texttt{vite}] per la compilazione e il \textit{bundling} del codice;
        \item[\texttt{vue}] per la creazione delle componenti, inoltre i seguenti sotto-moduli sono stati utilizzati:
            \begin{description}
                \item[\texttt{vue-router}] per la gestione delle rotte;
                \item[\texttt{vue-tsc}] per il \textit{type-checking} di \texttt{Vue.js};
                \item[\texttt{vue-leftlet}] per la gestione delle mappe;
            \end{description}
    \end{description}
\section{\textit{Database}}
    Il \textit{database} è stato progettato per contenere le seguenti collezioni:
    \subsection{Quartiere}
        La collezione \texttt{Quartiere} viene usata per memorizzare i dati relativi ai quartieri di Trento. Ogni documento della collezione contiene i seguenti campi:
        \begin{description}
            \item[\texttt{\_id}] (\texttt{ObjectId}) identificativo univoco del quartiere;
            \item[\texttt{nome}] (\texttt{String}) nome del quartiere;
            \item[\texttt{coordinate}] (\texttt{Number[][]}) coordinate del quartiere;
            \item[\texttt{circoscrizione}] (\texttt{ObjectId}) identificativo della circoscrizione a cui appartiene il quartiere;
            \item[\texttt{popolazione}] (\texttt{Number}) numero di abitanti del quartiere;
            \item[\texttt{superficie}] (\texttt{Number}) superficie del quartiere in $km^2$;
            \item[\texttt{serviziTotali}] (\texttt{Number}) numero totale di servizi presenti nel quartiere;
            \item[\texttt{interventiPolizia}] (\texttt{Number}) numero di interventi della polizia nel quartiere;
            \item[\texttt{etaMedia}] (\texttt{Number}) età media degli abitanti del quartiere;
            \item[\texttt{servizi}] (\texttt{Object}) oggetto contenente i servizi presenti nel quartiere;
                \begin{description}
                    \item[\texttt{areeVerdi}] (\texttt{Number}) numero di aree verdi presenti nel quartiere;
                    \item[\texttt{scuole}] (\texttt{Number}) numero di scuole presenti nel quartiere;
                    \item[\texttt{serviziRistorazione}] (\texttt{Number}) numero di servizi di ristorazione presenti nel quartiere;
                    \item[\texttt{localiNotturni}]
                \end{description}
            \item[\texttt{sicurezza}] (\texttt{Object}) oggetto contenente i dati relativi alla sicurezza del quartiere;
                \begin{description}
                    \item[\texttt{numeroInterventi}] (\texttt{Number}) numero di interventi della polizia nel quartiere;
                    \item[\texttt{incidenti}] (\texttt{Number}) numero di incidenti nel quartiere;
                    \item[\texttt{tassoCriminalità}] (\texttt{Number}) tasso di criminalità del quartiere;
                \end{description}
        \end{description}
    \subsection{Circoscrizione}
        La collezione \texttt{Circoscrizione} viene usata solamente per la memorizzazione delle coordinate e del nome delle circoscrizioni di Trento, questo in quanto i dati relativi alle circoscrizioni vengono estrapolati dai dati dei quartieri stessi. Ogni documento della collezione contiene i seguenti campi:
        \begin{description}
            \item[\texttt{\_id}] (\texttt{ObjectId}) identificativo univoco della circoscrizione;
            \item[\texttt{nome}] (\texttt{String}) nome della circoscrizione;
            \item[\texttt{coordinate}] (\texttt{Number[][]}) coordinate della circoscrizione;
        \end{description}
    \subsection{Sondaggio}
        La collezione \texttt{Sondaggio} viene usata per memorizzare i dati relativi ai sondaggi effettuati dai sondaggisti, in particolare 
        Ogni documento della collezione contiene i seguenti campi:
        \begin{description}
            \item[\texttt{\_id}] (\texttt{ObjectId}) identificativo univoco del sondaggio;
            \item[\texttt{titolo}] (\texttt{String}) titolo del sondaggio;
            \item[\texttt{dataInizio}] (\texttt{Date}) data di inizio del sondaggio;
            \item[\texttt{isAperto}] (\texttt{Boolean}) \textit{flag} che indica se il sondaggio è aperto o chiuso;
            \item[\texttt{statoApprovazione}] (\texttt{In attesa|Approvato|Rifiutato}) stato di approvazione del sondaggio;
            \item[\texttt{sondaggista}] (\texttt{ObjectId}) identificativo del sondaggista;
        \end{description}
    \subsection{\textit{User}}
        La collezione \texttt{User} viene usata per memorizzare i dati relativi agli utenti dell'applicazione. Questa collection viene strutturata in questo modo in quanto per lo scopo del progetto non viene implementato il sistema di autenticazione \texttt{SSO} tramite \texttt{SPID}/\texttt{CIE}/\texttt{TS-CNS}. Nel caso si dovesse implementare un sistema di autenticazione tramite \texttt{SSO} pubblico la collezione conterrebbe solo una associazione tra l'utente e i suoi dati personali.
        Ogni documento della collezione contiene i seguenti campi:
        \begin{description}
            \item[\texttt{\_id}] (\texttt{ObjectId}) identificativo univoco dell'utente;
            \item[\texttt{nome}] (\texttt{String}) nome dell'utente;
            \item[\texttt{cognome}] (\texttt{String}) cognome dell'utente;
            \item[\texttt{email}] (\texttt{String}) email dell'utente;
            \item[\texttt{password}] (\texttt{String}) password dell'utente;
            \item[\texttt{ruolo}] (\texttt{Amministratore|Analista|Sondaggista|Circoscrizione}) ruolo dell'utente;
            \item[\texttt{imageUrl}] (\texttt{String}) \textit{Hash} dell'immagine profilo dell'utente;
        \end{description}
    \subsection{Voto}
        La collezione \texttt{Voto} viene usata per memorizzare i voti dati dai cittadini ai quartieri. Ogni documento della collezione contiene i seguenti campi:
        \begin{description}
            \item[\texttt{\_id}] (\texttt{ObjectId}) identificativo univoco del voto;
            \item[\texttt{eta}] (\texttt{Number}) età del votante;
            \item[\texttt{voto}] (\texttt{Number}) voto dato al quartiere;
            \item[\texttt{quartiere}] (\texttt{ObjectId}) identificativo del quartiere votato;
            \item[\texttt{dataOra}] (\texttt{Date}) data e ora del voto;
            \item[\texttt{sondaggio}] (\texttt{ObjectId}) identificativo del sondaggio a cui il voto è associato;
        \end{description}
\section{Testing}

    Per ognuno dei requisiti funzionali implementati nell'applicazione sono stati individuati dei casi di test per assicurare la loro corretta implementazione e, in generale, il corretto funzionamento degli elementi di frontend e backend del sistema, anche in situazioni di casi limite.
    \begin{table}[H]
        \footnotesize
        \centering
        \begin{tabularx}{\textwidth}{|l|X|X|X|c|X|X|c|}
            \hline
            \textbf{N.} & \textbf{Descrizione} & \textbf{\textit{Data}} & \textbf{Precondizioni} & \textbf{Dipendenze} & \textbf{Risultato Atteso} & \textbf{Risultato Riscontrato} & \textbf{Note} \\
            \hline
            1 & Ottenimento lista quartieri base senza coordinate & \textit{deepData=false}, \textit{coordinate=false} & - & - & Lista quartieri senza coordinate & Lista quartieri senza coordinate & - \\
            \hline
            1.1 & Ottenimento lista quartieri base con coordinate & \textit{deepData=false} \textit{coordinate=true} & - & - & Lista quartieri con coordinate & Lista quartieri con coordinate & - \\
            \hline
            1.2 & Ottenimento lista quartieri dettagliata senza coordinate & \textit{deepData=true} \textit{coordinate=false} & - & - & Lista quartieri dettagliata senza coordinate & Lista quartieri dettagliata senza coordinate & - \\
            \hline
            1.3 & Ottenimento lista quartieri dettagliata con coordinate & \textit{deepData=true} \textit{coordinate=true} & - & - & Lista quartieri dettagliata con coordinate & Lista quartieri dettagliata con coordinate & - \\
            \hline
            2 & Ottenimento singolo quartiere con coordinate & \textit{quartiereId}, \textit{coordinate=true} & Il quartiere deve esistere & - & Quartiere con coordinate & Quartiere con coordinate & - \\
            \hline
            2.1 & Ottenimento singolo quartiere senza coordinate & \textit{quartiereId}, \textit{coordinate=false} & Il quartiere deve esistere & - & Quartiere senza coordinate & Quartiere senza coordinate & - \\
            \hline
            2.2 & Ottenimento quartiere non esistente & \textit{quartiereId}, \textit{coordinate=any} & Il quartiere non deve esistere & - & Errore \texttt{404} & Errore \texttt{404} & - \\
            \hline
            2.3 & Ottenimento quartiere con \texttt{ID} non valido & \textit{quartiereId}, \textit{coordinate=any} & Il \texttt{ID} del quartiere deve essere valido & - & Errore \texttt{400} & Errore \texttt{400} & - \\
            \hline
        \end{tabularx}
    \end{table}