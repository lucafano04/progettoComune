openapi: 3.0.0
info:
  title: API Documentation
  description: This is the API documentation for the project.
  version: 0.0.1
servers:
  - url: http://localhost:3000
    description: Development server for testing

components:
  schemas:
    DatiBase:
      description: Oggetto contenente le informazioni di base di un quartiere.
      type: object
      properties:
        popolazione:
            type: integer
            description: Numero di abitanti del quartiere.
        superficie:
          type: number
          description: Superficie del quartiere in km^2.
          format: double
        serviziTotali: 
          type: integer
          description: Numero totale di servizi presenti nel quartiere.
        soddisfazioneMedia:
          type: number
          description: Soddisfazione media degli abitanti del quartiere.
          format: double
          minimum: 0
          maximum: 100
        interventiPolizia: 
          type: integer
          description: Numero di interventi delle forze dell'ordine nel quartiere.
        etaMedia:
          type: number
          description: Età media degli abitanti del quartiere.
          format: double
    ServiziGenerali:
      description: Oggetto contenente le informazioni sui servizi presenti in un quartiere.
      type: object
      properties:
        areeVerdi:
          type: integer
          description: Numero di aree verdi presenti nel quartiere.
          minimum: 0
        scuole:
          type: integer
          description: Numero di scuole presenti nel quartiere.
          minimum: 0
        serviziRistorazione:
          type: integer
          description: Numero di servizi di ristorazione presenti nel quartiere.
          minimum: 0
        localiNotturni: 
          type: integer
          description: Numero di locali notturni presenti nel quartiere.
          minimum: 0
    Sicurezza:
      description: Oggetto contenente le informazioni sulla sicurezza di un quartiere.
      type: object
      properties:
        numeroInterventi:
          type: integer
          description: Numero di interventi delle forze dell'ordine nel quartiere.
          minimum: 0
        incidenti: 
          type: integer
          description: Numero di incidenti nel quartiere.
          minimum: 0
        tassoCriminalita:
          type: number
          description: Tasso di criminalità del quartiere.
          format: double
          minimum: 0
    Coordinate:
      description: Array di coordinate che definiscono un quartiere e/o circoscrizione.
      type: array
      items: 
        description: Coordinate nel formato [latitude, longitude].
        type: array
        items:
          type: number
          format: double
        minItems: 2
        maxItems: 2
      minItems: 1
      uniqueItems: true
    Soddisfazione: 
        type: "number"
        description: "Soddisfazione media degli abitanti del quartiere."
        format: "double"
        minimum: 0
        maximum: 100
    CircoscrizioneBase: 
      description: Oggetto contenente le informazioni di Base di una circoscrizione.
      type: object
      properties:
        id:
          type: integer
          description: Identificatore univoco della circoscrizione.
        nome:
          type: string
          description: Nome della circoscrizione.
        coordinate:
          "$ref": "#/components/schemas/Coordinate"
        soddisfazioneMedia:
          "$ref": "#/components/schemas/Soddisfazione"
    Circoscrizione:
      description: Oggetto contenente le informazioni di una circoscrizione.
      allOf:
        - "$ref": "#/components/schemas/CircoscrizioneBase"
        - "$ref": "#/components/schemas/DatiBase"
      type: object
      properties:
        servizi:
          "$ref": "#/components/schemas/ServiziGenerali"
        storicoSoddisfazione:
          "$ref": "#/components/schemas/ArrayStoricoSoddisfazione"
        sicurezza:
          "$ref": "#/components/schemas/Sicurezza"
    QuartiereBase: 
      description: Oggetto contenente le informazioni di base di un quartiere.
      type: object
      properties:
        id:
          type: "integer"
          description: "Identificatore univoco del quartiere."
        nome:
          type: "string"
          description: "Nome del quartiere."
        coordinate:
          "$ref": "#/components/schemas/Coordinate"
        circoscrizione:
          "$ref": "#/components/schemas/CircoscrizioneBase"
        soddisfazioneMedia:
          "$ref": "#/components/schemas/Soddisfazione"
    Quartiere: 
      description: Oggetto contenente le informazioni di un quartiere.
      allOf:
        - "$ref": "#/components/schemas/QuartiereBase"
        - "$ref": "#/components/schemas/DatiBase"
      type: object
      properties:
        servizi:
          "$ref": "#/components/schemas/ServiziGenerali"
        storicoSoddisfazione:
          "$ref": "#/components/schemas/ArrayStoricoSoddisfazione"
        sicurezza:
          "$ref": "#/components/schemas/Sicurezza"
    StoricoSoddisfazione:
      description: Oggetto contenente le informazioni storiche sulla soddisfazione di un quartiere.
      type: object
      properties:
        data:
          type: string
          description: Data in cui è stata effettuata la misurazione.
          format: date
        soddisfazioneMedia:
          "$ref": "#/components/schemas/Soddisfazione"
    ArrayStoricoSoddisfazione:
      description: Array di oggetti contenenti le informazioni storiche sulla soddisfazione di un quartiere.
      type: array
      items:
        "$ref": "#/components/schemas/StoricoSoddisfazione"
    User:
      description: Oggetto contenente le informazioni di un utente.
      type: object
      properties:
        email:
          type: string
          description: Email dell'utente.
        nome:
          type: string
          description: Nome dell'utente.
        cognome:
          type: string
          description: Cognome dell'utente.
        ruolo:
          type: string
          enum:
            - "amministratore"
            - "analista"
            - "sondaggista"
            - "circoscrizione"
          description: Ruolo dell'utente.
        imageUrl: 
          type: string
          description: Url dell'immagine profilo dell'utente. (gravatar)
    Session: 
      description: Oggetto contenente le informazioni di una sessione.
      type: object
      properties:
        token:
          type: string
          description: Token di autenticazione dell'utente.
        user:
          "$ref": "#/components/schemas/User"
    Error:
      description: Oggetto contenente le informazioni di un errore.
      type: object
      properties:
        code:
          type: integer
          description: Codice dell'errore.
        message:
          type: string
          description: Messaggio di errore.
        details:
          type: string
          description: Dettagli dell'errore.
          nullable: true
    BasicOkResponse:
      description: Oggetto contenente le informazioni di una risposta di successo.
      type: object
      properties:
        ok:
          type: boolean
          description: Indica se la richiesta è stata eseguita con successo.
          default: true
        message:
          type: string
          description: Messaggio di successo della richiesta.
          nullable: true
    SondaggioBase: 
      description: Oggetto contenente le informazioni di base di un sondaggio.
      type: object
      properties:
        id:
          type: integer
          description: Identificatore univoco del sondaggio.
        titolo:
          type: string
          description: Titolo del sondaggio.
        dataInizio:
          type: string
          description: Data di inizio del sondaggio.
          format: date
        isAperto:
          type: boolean
          description: Indica se il sondaggio è aperto (in corso) o chiuso.
        statoApprovazione:
          type: string
          enum:
            - "approvato"
            - "in attesa"
            - "rifiutato"
          description: Stato di approvazione del sondaggio.
        sondaggista:
          "$ref": "#/components/schemas/User"
    ElencoSondaggi:
      description: Array di oggetti contenenti le informazioni di base di un sondaggio (visualizzaione sonfaggista/admin).
      type: array
      items:
        "$ref": "#/components/schemas/SondaggioBase"
    Voto:
      description: Oggetto contenente le informazioni di un voto.
      type: object
      properties:
        id:
          type: integer
          description: Identificatore univoco del voto.
        dataOra:
          type: string
          description: Data e ora in cui è stato effettuato il voto.
          format: date-time
        eta:
          type: integer
          description: Età dell'utente che ha effettuato il voto.
          minimum: 0 # TODO: @Boss314 & @Lukil33 decidere se mettere dei range o lasciare il numero libero
        voto:
          type: integer
          description: Voto assegnato al quartiere.
          minimum: 1
          maximum: 5
        quartiere:
          type: integer
          description: Identificatore univoco del quartiere.
    MediaVoti:
      description: Oggetto semplice contenente la media dei voti di un quartiere.
      type: object
      properties:
        media:
          type: number
          description: Media dei voti assegnati al quartiere.
          format: double
          minimum: 1
          maximum: 5
        quartiere:
          type: integer
          description: Identificatore univoco del quartiere.
    Sondaggio:
      description: Oggetto contenente le informazioni di un sondaggio.
      allOf:
        - "$ref": "#/components/schemas/SondaggioBase"
      type: object
      properties:
        descrizione:
          type: string
          description: Descrizione del sondaggio.
        voti:
          type: array
          items:
            "$ref": "#/components/schemas/Voto"
          description: Array di oggetti contenenti i voti assegnati al sondaggio.
        mediaVoti:
          type: array
          items:
            "$ref": "#/components/schemas/MediaVoti"
          description: Array di oggetti contenenti la media dei voti assegnati ai quartieri presenti nel sondaggio (quelli non presenti non vengono visualizzati).
        

paths:
  '/api/quartieri' :
    description: "Risorsa che restituisce la lista dei quartieri di Trento."
    get: 
      description: "Ritorna una lista di tutti i quartieri della città di Trento."
      parameters:
        - name: deepData
          in: query
          description: "Se impostato a true, restituisce le informazioni complete di ogni quartiere."
          required: false
          schema:
            type: boolean
            default: false
          allowEmptyValue: true
      responses: 
        200: 
          description: "Successful response"
          content:
            application/json:
              schema: 
                oneOf:
                  - type: array
                    items: 
                      "$ref": "#/components/schemas/QuartiereBase"
                  - type: array
                    items: 
                      "$ref": "#/components/schemas/Quartiere"
  '/api/quartieri/{id}' :
    description: "Risorsa che restituisce le informazioni di un quartiere di Trento con le informazioni di base e i servizi presenti."
    get: 
      responses: 
        200:
          description: "Risposta con le informazioni del quartiere."
          content:
            application/json: 
              schema: 
                $ref: "#/components/schemas/Quartiere"
        404: 
          description: "Quartiere non trovato."
          content: 
            application/json: 
              schema: 
                "$ref": "#/components/schemas/Error"
  '/api/circoscrizioni' : 
    description: "Risorsa che restituisce la lista delle circoscrizioni di Trento."
    get: 
      description: "Returns a list of all the districts in the city of Trento."
      parameters:
        - name: deepData
          in: query
          description: "Se impostato a true, restituisce le informazioni complete di ogni circoscrizione."
          required: false
          schema:
            type: boolean
            default: false
          allowEmptyValue: true
      responses:
        200 :
          description: "Successful response"
          content:
            application/json:
              schema: 
                oneOf:
                  - type: "array"
                    items: 
                      "$ref": "#/components/schemas/CircoscrizioneBase"
                  - type: "array"
                    items: 
                      "$ref": "#/components/schemas/Circoscrizione"
  '/api/circoscrizioni/{id}' :
    description: "Risorsa che restituisce le informazioni di una circoscrizione di Trento con le informazioni di base e i servizi presenti."
    get: 
      responses: 
        200:
          description: "Risposta con le informazioni della circoscrizione."
          content:
            application/json: 
              schema: 
                $ref: "#/components/schemas/Circoscrizione"
        404: 
          description: "Circoscrizione non trovata."
          content: 
            application/json: 
              schema: 
                "$ref": "#/components/schemas/Error"
  '/api/generalInfo' :
    description: "Risorsa che restituisce le informazioni generali della città di Trento."
    get: 
      description: "Restituisce le informazioni generali della città di Trento."
      responses: 
        200 : 
          description: "Successful response"
          content: 
            application/json:
              schema: 
                type: "object"
                properties: 
                  popolazione :
                    type: integer
                    description: "Numero di abitanti della città di Trento."
                  superficie :
                    type: number
                    description: "Superficie della città di Trento in km^2."
                    format: double
                  etaMedia :
                    type: number
                    description: "Età media degli abitanti della città di Trento."
                    format: double
                  soddisfazioneMedia: 
                    type: number
                    description: "Soddisfazione media degli abitanti della città di Trento."
                    format: double
                    minimum: 0
                    maximum: 100
  '/api/session':
    description: "Risorsa che restituisce le informazioni della sessione dell'utente."
    get:
      description: "Restituisce le informazioni della sessione dell'utente, se presente."
      parameters:
        - name: token
          in: header
          description: "Token di autenticazione dell'utente."
          required: true
          schema:
            type: string
      responses:
        200:
          description: "Successful response"
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/User"
        401:
          description: "Utente non autenticato."
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/Error"
        404:
          description: "Sessione non trovata."
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/Error"
    post: 
      description: "Crea una nuova sessione per l'utente."
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  description: "Email dell'utente."
                password:
                  type: string
                  description: "Password (codificata) dell'utente."
      responses:
        200:
          description: "Sessione creata con successo."
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/Session"
        401:
          description: "Credenziali non valide."
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/Error"
    delete: 
      description: "Elimina la sessione dell'utente."
      parameters:
        - name: token
          in: header
          description: "Token di autenticazione dell'utente."
          required: true
          schema:
            type: string
      responses:
        200:
          description: "Sessione eliminata con successo."
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/BasicOkResponse"
        401:
          description: "Sessione non trovata."
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/Error"
  '/api/sondaggi' :
    description: "Risorsa che restituisce la lista dei sondaggi dell'utente corrente, se amministratore allora restituisce tutti i sondaggi."
    get: 
      description: "Restituisce la lista dei sondaggi dell'utente corrente."
      parameters:
        - name: token
          in: header
          description: "Token di autenticazione dell'utente."
          required: true
          schema:
            type: string
      responses:
        200:
          description: "Successful response"
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ElencoSondaggi"
        401:
          description: "Utente non autenticato."
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/Error"
  '/api/sondaggi/{id}' :
    description: "Risorsa che restituisce le informazioni di un sondaggio."
    get: 
      description: "Restituisce le informazioni di un sondaggio."
      parameters:
        - name: token
          in: header
          description: "Token di autenticazione dell'utente."
          required: true
          schema:
            type: string
      responses:
        200:
          description: "Successful response"
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/Sondaggio"
        401:
          description: "Utente non autenticato."
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/Error"
        404:
          description: "Sondaggio non trovato."
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/Error"
  